<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Loïc Hoguin based on a design from (Soft10) Pol Cámara">

    <title>Nine Nines: gun(3)</title>

    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic' rel='stylesheet' type='text/css'>
    <link href="/css/99s.css?r=6" rel="stylesheet">

    <link rel="shortcut icon" href="/img/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/ico/apple-touch-icon-114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/ico/apple-touch-icon-72.png">
    <link rel="apple-touch-icon-precomposed" href="/img/ico/apple-touch-icon-57.png">

    
</head>


<body class="">
  <header id="page-head">
    <div id="topbar" class="container">
        <div class="row">
          <div class="span2">
            <h1 id="logo"><a href="/" title="99s">99s</a></h1>
          </div>
          <div class="span10">
            
            <div id="side-header">
              <nav>
                <ul>
                  <li><a title="Hear my thoughts" href="/articles">Articles</a></li>
  				  <li><a title="Watch my talks" href="/talks">Talks</a></li>
  				  <li class="active"><a title="Read the docs" href="/docs">Documentation</a></li>
  				  <li><a title="Request my services" href="/services">Consulting & Training</a></li>
                </ul>
              </nav> 
              <ul id="social">
                <li>
                  <a href="https://github.com/ninenines" title="Check my Github repositories"><img src="/img/ico_github.png" data-hover="/img/ico_github_alt.png" alt="Github"></a>
                </li>
                    <li>
						<a title="Contact me" href="mailto:contact@ninenines.eu"><img src="/img/ico_mail.png" data-hover="/img/ico_mail_alt.png"></a>
					</li>
              </ul>
            </div>
          </div>
        </div>
    </div>


</header>

<div id="contents" class="two_col">
<div class="container">
<div class="row">
<div id="docs" class="span9 maincol">

<h1 class="lined-header"><span>gun(3)</span></h1>

<h2 id="_name">Name</h2>
<p>gun - Asynchronous HTTP client</p>
<h2 id="_description">Description</h2>
<p>The <code>gun</code> module provides an asynchronous interface for connecting and communicating with Web servers over HTTP, HTTP/2 or Websocket.</p>
<h2 id="_exports">Exports</h2>
<p>Connection:</p>
<ul><li><a href="../gun.open">gun:open(3)</a> - Open a connection to the given host and port
</li>
<li><a href="../gun.open_unix">gun:open_unix(3)</a> - Open a connection to the given Unix domain socket
</li>
<li><a href="../gun.set_owner">gun:set_owner(3)</a> - Set a new owner for the connection
</li>
<li><a href="../gun.shutdown">gun:shutdown(3)</a> - Gracefully close the connection
</li>
<li><a href="../gun.close">gun:close(3)</a> - Brutally close the connection
</li>
<li><a href="../gun.info">gun:info(3)</a> - Obtain information about the connection
</li>
</ul>
<p>Requests:</p>
<ul><li><a href="../gun.get">gun:get(3)</a> - Get a resource representation
</li>
<li><a href="../gun.head">gun:head(3)</a> - Get headers of a resource representation
</li>
<li><a href="../gun.options">gun:options(3)</a> - Query the capabilities of the server or a resource
</li>
<li><a href="../gun.patch">gun:patch(3)</a> - Apply a set of changes to a resource
</li>
<li><a href="../gun.post">gun:post(3)</a> - Process the enclosed representation according to a resource&apos;s own semantics
</li>
<li><a href="../gun.put">gun:put(3)</a> - Create or replace a resource
</li>
<li><a href="../gun.delete">gun:delete(3)</a> - Delete a resource
</li>
<li><a href="../gun.headers">gun:headers(3)</a> - Initiate the given request
</li>
<li><a href="../gun.request">gun:request(3)</a> - Perform the given request
</li>
<li><a href="../gun.data">gun:data(3)</a> - Stream the body of a request
</li>
</ul>
<p>Proxies:</p>
<ul><li><a href="../gun.connect">gun:connect(3)</a> - Establish a tunnel to the origin server
</li>
</ul>
<p>Messages:</p>
<ul><li><a href="../gun.await">gun:await(3)</a> - Wait for a response
</li>
<li><a href="../gun.await_body">gun:await_body(3)</a> - Wait for the complete response body
</li>
<li><a href="../gun.await_up">gun:await_up(3)</a> - Wait for the connection to be up
</li>
<li><a href="../gun.flush">gun:flush(3)</a> - Flush all messages related to a connection or a stream
</li>
</ul>
<p>Streams:</p>
<ul><li><a href="../gun.update_flow">gun:update_flow(3)</a> - Update a stream&apos;s flow control value
</li>
<li><a href="../gun.cancel">gun:cancel(3)</a> - Cancel the given stream
</li>
<li><a href="../gun.stream_info">gun:stream_info(3)</a> - Obtain information about a stream
</li>
</ul>
<p>Websocket:</p>
<ul><li><a href="../gun.ws_upgrade">gun:ws_upgrade(3)</a> - Upgrade to Websocket
</li>
<li><a href="../gun.ws_send">gun:ws_send(3)</a> - Send Websocket frames
</li>
</ul>
<h2 id="_messages">Messages</h2>
<p>Gun will inform the calling process of events asynchronously by sending any of the following messages:</p>
<p>Connection:</p>
<ul><li><a href="../gun_up">gun_up(3)</a> - The connection is up
</li>
<li><a href="../gun_socks_up">gun_socks_up(3)</a> - The Socks connection is up
</li>
<li><a href="../gun_down">gun_down(3)</a> - The connection is down
</li>
<li><a href="../gun_upgrade">gun_upgrade(3)</a> - Successful protocol upgrade
</li>
<li><a href="../gun_error">gun_error(3)</a> - Stream or connection-wide error
</li>
</ul>
<p>Responses:</p>
<ul><li><a href="../gun_push">gun_push(3)</a> - Server-initiated push
</li>
<li><a href="../gun_inform">gun_inform(3)</a> - Informational response
</li>
<li><a href="../gun_response">gun_response(3)</a> - Response
</li>
<li><a href="../gun_data">gun_data(3)</a> - Response body
</li>
<li><a href="../gun_trailers">gun_trailers(3)</a> - Response trailers
</li>
</ul>
<p>Websocket:</p>
<ul><li><a href="../gun_ws">gun_ws(3)</a> - Websocket frame
</li>
</ul>
<p>The response messages will be sent to the process that opened the connection by default. The <code>reply_to</code> request option can be used to redirect request-specific messages to a different process.</p>
<h2 id="_types">Types</h2>
<h3 id="_connect_destination">connect_destination()</h3>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">connect_destination</font></b>() <font color="#990000">::</font> #{
    <font color="#FF6600">host</font>      <font color="#990000">:=</font> <b><font color="#000000">inet:hostname</font></b>() | <b><font color="#000000">inet:ip_address</font></b>(),
    <font color="#FF6600">port</font>      <font color="#990000">:=</font> <b><font color="#000000">inet:port_number</font></b>(),

    <font color="#0000FF">username</font>  <font color="#990000">=&gt;</font> <b><font color="#000000">iodata</font></b>(),
    <font color="#0000FF">password</font>  <font color="#990000">=&gt;</font> <b><font color="#000000">iodata</font></b>(),
    <font color="#0000FF">protocols</font> <font color="#990000">=&gt;</font> <b><font color="#000000">protocols</font></b>(),
    <font color="#0000FF">transport</font> <font color="#990000">=&gt;</font> <font color="#FF6600">tcp</font> | <font color="#FF6600">tls</font>,

    <font color="#0000FF">tls_opts</font>              <font color="#990000">=&gt;</font> [<b><font color="#000000">ssl:tls_client_option</font></b>()],
    <font color="#0000FF">tls_handshake_timeout</font> <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>()
}</tt></pre>
</div></div>
<p>Destination of a CONNECT request.</p>
<p>The default value, if any, is given next to the option name:</p>
<dl><dt>host, port</dt>
<dd><p>Destination hostname and port number. Mandatory.</p>
<p>Upon successful completion of the CONNECT request, Gun will begin using these as the host and port of the origin server for subsequent requests.</p>
</dd>
<dt>username, password</dt>
<dd><p>Proxy authorization credentials. They are only sent when both options are provided.</p>
</dd>
<dt>protocols - see below</dt>
<dd><p>Ordered list of preferred protocols. Please refer to the <code>protocols()</code> type documentation for details.</p>
<p>Defaults to <code>[http]</code> when the transport is <code>tcp</code>, and <code>[http2, http]</code> when the transport is <code>tls</code>.</p>
</dd>
<dt>transport (tcp)</dt>
<dd><p>Transport that will be used for tunneled requests.</p>
</dd>
<dt>tls_opts ([])</dt>
<dd><p>Options to use for tunneled TLS connections.</p>
</dd>
<dt>tls_handshake_timeout (infinity)</dt>
<dd><p>Handshake timeout for tunneled TLS connections.</p>
</dd>
</dl>
<h3 id="_http_opts">http_opts()</h3>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">http_opts</font></b>() <font color="#990000">::</font> #{
    <font color="#0000FF">closing_timeout</font>       <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">flow</font>                  <font color="#990000">=&gt;</font> <b><font color="#000000">pos_integer</font></b>(),
    <font color="#0000FF">keepalive</font>             <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">transform_header_name</font> <font color="#990000">=&gt;</font> <b><font color="#0000FF">fun</font></b>((<b><font color="#000080">binary</font></b>()) <font color="#990000">-&gt;</font> <b><font color="#000080">binary</font></b>()),
    <font color="#0000FF">version</font>               <font color="#990000">=&gt;</font> <font color="#FF6600">'HTTP/1.1'</font> | <font color="#FF6600">'HTTP/1.0'</font>
}</tt></pre>
</div></div>
<p>Configuration for the HTTP protocol.</p>
<p>The default value is given next to the option name:</p>
<!-- @todo Document content_handlers and gun_sse_h.-->
<dl><dt>closing_timeout (15000)</dt>
<dd><p>Time to wait before brutally closing the connection when a graceful shutdown was requested via a call to <a href="../gun.shutdown">gun:shutdown(3)</a>.</p>
</dd>
<dt>flow - see below</dt>
<dd><p>The initial flow control value for all HTTP/1.1 streams. By default flow control is disabled.</p>
</dd>
<dt>keepalive (infinity)</dt>
<dd><p>Time between pings in milliseconds. Since the HTTP protocol has no standardized way to ping the server, Gun will simply send an empty line when the connection is idle. Gun only makes a best effort here as servers usually have configurable limits to drop idle connections. Disabled by default due to potential incompatibilities.</p>
</dd>
<dt>transform_header_name - see below</dt>
<dd><p>A function that will be applied to all header names before they are sent to the server. Gun assumes that all header names are in lower case. This function is useful if you, for example, need to re-case header names in the event that the server incorrectly considers the case of header names to be significant.</p>
</dd>
<dt>version (<code>&apos;HTTP/1.1&apos;</code>)</dt>
<dd><p>HTTP version to use.</p>
</dd>
</dl>
<h3 id="_http2_opts">http2_opts()</h3>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">http2_opts</font></b>() <font color="#990000">::</font> #{
    <font color="#0000FF">closing_timeout</font> <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">flow</font>            <font color="#990000">=&gt;</font> <b><font color="#000000">pos_integer</font></b>(),
    <font color="#0000FF">keepalive</font>       <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),

    <i><font color="#9A1900">%% HTTP/2 state machine configuration.</font></i>
    <font color="#0000FF">connection_window_margin_size</font>  <font color="#990000">=&gt;</font> <font color="#993399">0</font><font color="#990000">..</font><font color="#993399">16#7fffffff</font>,
    <font color="#0000FF">connection_window_update_threshold</font> <font color="#990000">=&gt;</font> <font color="#993399">0</font><font color="#990000">..</font><font color="#993399">16#7fffffff</font>,
    <font color="#0000FF">enable_connect_protocol</font>        <font color="#990000">=&gt;</font> <b><font color="#000000">boolean</font></b>(),
    <font color="#0000FF">initial_connection_window_size</font> <font color="#990000">=&gt;</font> <font color="#993399">65535</font><font color="#990000">..</font><font color="#993399">16#7fffffff</font>,
    <font color="#0000FF">initial_stream_window_size</font>     <font color="#990000">=&gt;</font> <font color="#993399">0</font><font color="#990000">..</font><font color="#993399">16#7fffffff</font>,
    <font color="#0000FF">max_concurrent_streams</font>         <font color="#990000">=&gt;</font> <b><font color="#000000">non_neg_integer</font></b>() | <font color="#FF6600">infinity</font>,
    <font color="#0000FF">max_connection_window_size</font>     <font color="#990000">=&gt;</font> <font color="#993399">0</font><font color="#990000">..</font><font color="#993399">16#7fffffff</font>,
    <font color="#0000FF">max_decode_table_size</font>          <font color="#990000">=&gt;</font> <b><font color="#000000">non_neg_integer</font></b>(),
    <font color="#0000FF">max_encode_table_size</font>          <font color="#990000">=&gt;</font> <b><font color="#000000">non_neg_integer</font></b>(),
    <font color="#0000FF">max_frame_size_received</font>        <font color="#990000">=&gt;</font> <font color="#993399">16384</font><font color="#990000">..</font><font color="#993399">16777215</font>,
    <font color="#0000FF">max_frame_size_sent</font>            <font color="#990000">=&gt;</font> <font color="#993399">16384</font><font color="#990000">..</font><font color="#993399">16777215</font> | <font color="#FF6600">infinity</font>,
    <font color="#0000FF">max_stream_buffer_size</font>         <font color="#990000">=&gt;</font> <b><font color="#000000">non_neg_integer</font></b>(),
    <font color="#0000FF">max_stream_window_size</font>         <font color="#990000">=&gt;</font> <font color="#993399">0</font><font color="#990000">..</font><font color="#993399">16#7fffffff</font>,
    <font color="#0000FF">preface_timeout</font>                <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">settings_timeout</font>               <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">stream_window_margin_size</font>      <font color="#990000">=&gt;</font> <font color="#993399">0</font><font color="#990000">..</font><font color="#993399">16#7fffffff</font>,
    <font color="#0000FF">stream_window_update_threshold</font> <font color="#990000">=&gt;</font> <font color="#993399">0</font><font color="#990000">..</font><font color="#993399">16#7fffffff</font>
}</tt></pre>
</div></div>
<p>Configuration for the HTTP/2 protocol.</p>
<p>The default value is given next to the option name:</p>
<!-- @todo Document content_handlers and gun_sse_h.-->
<dl><dt>closing_timeout (15000)</dt>
<dd><p>Time to wait before brutally closing the connection when a graceful shutdown was requested either via a call to <a href="../gun.shutdown">gun:shutdown(3)</a> or by the server.</p>
</dd>
<dt>flow - see below</dt>
<dd><p>The initial flow control value for all HTTP/2 streams. By default flow control is disabled.</p>
</dd>
<dt>keepalive (5000)</dt>
<dd><p>Time between pings in milliseconds.</p>
</dd>
</dl>
<h3 id="_opts">opts()</h3>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">opts</font></b>() <font color="#990000">::</font> #{
    <font color="#0000FF">connect_timeout</font>       <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">domain_lookup_timeout</font> <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">http_opts</font>             <font color="#990000">=&gt;</font> <b><font color="#000000">http_opts</font></b>(),
    <font color="#0000FF">http2_opts</font>            <font color="#990000">=&gt;</font> <b><font color="#000000">http2_opts</font></b>(),
    <font color="#0000FF">protocols</font>             <font color="#990000">=&gt;</font> <b><font color="#000000">protocols</font></b>(),
    <font color="#0000FF">retry</font>                 <font color="#990000">=&gt;</font> <b><font color="#000000">non_neg_integer</font></b>(),
    <font color="#0000FF">retry_fun</font>             <font color="#990000">=&gt;</font> <b><font color="#0000FF">fun</font></b>(),
    <font color="#0000FF">retry_timeout</font>         <font color="#990000">=&gt;</font> <b><font color="#000000">pos_integer</font></b>(),
    <font color="#0000FF">supervise</font>             <font color="#990000">=&gt;</font> <b><font color="#000000">boolean</font></b>(),
    <font color="#0000FF">tcp_opts</font>              <font color="#990000">=&gt;</font> [<b><font color="#000000">gen_tcp:connect_option</font></b>()],
    <font color="#0000FF">tls_handshake_timeout</font> <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">tls_opts</font>              <font color="#990000">=&gt;</font> [<b><font color="#000000">ssl:tls_client_option</font></b>()],
    <font color="#0000FF">trace</font>                 <font color="#990000">=&gt;</font> <b><font color="#000000">boolean</font></b>(),
    <font color="#0000FF">transport</font>             <font color="#990000">=&gt;</font> <font color="#FF6600">tcp</font> | <font color="#FF6600">tls</font>,
    <font color="#0000FF">ws_opts</font>               <font color="#990000">=&gt;</font> <b><font color="#000000">ws_opts</font></b>()
}</tt></pre>
</div></div>
<p>Configuration for the connection.</p>
<p>The default value is given next to the option name:</p>
<dl><dt>connect_timeout (infinity)</dt>
<dd><p>Connection timeout.</p>
</dd>
<dt>domain_lookup_timeout (infinity)</dt>
<dd><p>Domain lookup timeout.</p>
</dd>
<dt>http_opts (#{})</dt>
<dd><p>Options specific to the HTTP protocol.</p>
</dd>
<dt>http2_opts (#{})</dt>
<dd><p>Options specific to the HTTP/2 protocol.</p>
</dd>
<dt>protocols - see below</dt>
<dd><p>Ordered list of preferred protocols. Please refer to the <code>protocols()</code> type documentation for details.</p>
<p>Defaults to <code>[http]</code> when the transport is <code>tcp</code>, and <code>[http2, http]</code> when the transport is <code>tls</code>.</p>
</dd>
<dt>retry (5)</dt>
<dd><p>Number of times Gun will try to reconnect on failure before giving up.</p>
</dd>
<dt>retry_fun - see below</dt>
<dd><p>A fun that will be called before every reconnect attempt. It receives the current number of retries left and the Gun options. It returns the next number of retries left and the timeout to apply before reconnecting.</p>
</dd>
</dl>
<p>The default fun will remove one to the number of retries and set the timeout to the <code>retry_timeout</code> value.</p>
<p>The fun must be defined as follow:</p>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#0000FF">fun</font></b> ((<b><font color="#000000">non_neg_integer</font></b>(), <b><font color="#000000">opts</font></b>()) <font color="#990000">-&gt;</font> #{
    <font color="#0000FF">retries</font> <font color="#990000">=&gt;</font> <b><font color="#000000">non_neg_integer</font></b>(),
    <font color="#0000FF">timeout</font> <font color="#990000">=&gt;</font> <b><font color="#000000">pos_integer</font></b>()
})</tt></pre>
</div></div>
<p>The fun will never be called when the <code>retry</code> option is set to 0. When this function returns 0 in the <code>retries</code> value, Gun will do one last reconnect attempt before giving up.</p>
<dl><dt>retry_timeout (5000)</dt>
<dd><p>Time between retries in milliseconds.</p>
</dd>
<dt>supervise (true)</dt>
<dd><p>Whether the Gun process should be started under the <code>gun_sup</code> supervisor. Set to <code>false</code> to use your own supervisor.</p>
</dd>
<dt>tcp_opts ([])</dt>
<dd><p>TCP options used when establishing the connection.</p>
</dd>
<dt>tls_handshake_timeout (infinity)</dt>
<dd><p>TLS handshake timeout.</p>
</dd>
<dt>tls_opts ([])</dt>
<dd><p>TLS options used for the TLS handshake after the connection has been established, when the transport is set to <code>tls</code>.</p>
</dd>
<dt>trace (false)</dt>
<dd><p>Whether to enable <code>dbg</code> tracing of the connection process. Should only be used during debugging.</p>
</dd>
<dt>transport - see below</dt>
<dd><p>Whether to use TLS or plain TCP. The default varies depending on the port used. Port 443 defaults to <code>tls</code>. All other ports default to <code>tcp</code>.</p>
</dd>
<dt>ws_opts (#{})</dt>
<dd><p>Options specific to the Websocket protocol.</p>
</dd>
</dl>
<h3 id="_protocols">protocols()</h3>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">protocols</font></b>() <font color="#990000">::</font> <font color="#FF6600">http</font> | {<font color="#FF6600">http</font>, <b><font color="#000000">http_opts</font></b>()}
             | <font color="#FF6600">http2</font> | {<font color="#FF6600">http2</font>, <b><font color="#000000">http2_opts</font></b>()}
             | <font color="#FF6600">socks</font> | {<font color="#FF6600">socks</font>, <b><font color="#000000">socks_opts</font></b>()}</tt></pre>
</div></div>
<p>Ordered list of preferred protocols. When the transport is <code>tcp</code>, this list must contain exactly one protocol. When the transport is <code>tls</code>, this list must contain at least one protocol and will be used to negotiate a protocol via ALPN. When the server does not support ALPN then <code>http</code> will be used, except when the list of preferred protocols is set to only accept <code>socks</code>.</p>
<p>Defaults to <code>[http]</code> when the transport is <code>tcp</code>, and <code>[http2, http]</code> when the transport is <code>tls</code>.</p>
<h3 id="_req_headers">req_headers()</h3>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">req_headers</font></b>() <font color="#990000">::</font> [{<b><font color="#000080">binary</font></b>() | <b><font color="#000000">string</font></b>() | <b><font color="#000080">atom</font></b>(),   <b><font color="#000000">iodata</font></b>()}]
               | #{<b><font color="#000080">binary</font></b>() | <b><font color="#000000">string</font></b>() | <b><font color="#000080">atom</font></b>() <font color="#990000">=&gt;</font> <b><font color="#000000">iodata</font></b>()}</tt></pre>
</div></div>
<p>Request headers.</p>
<h3 id="_req_opts">req_opts()</h3>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">req_opts</font></b>() <font color="#990000">::</font> #{
    <font color="#0000FF">flow</font>     <font color="#990000">=&gt;</font> <b><font color="#000000">pos_integer</font></b>(),
    <font color="#0000FF">reply_to</font> <font color="#990000">=&gt;</font> <b><font color="#000080">pid</font></b>()
}</tt></pre>
</div></div>
<p>Configuration for a particular request.</p>
<p>The default value is given next to the option name:</p>
<dl><dt>flow - see below</dt>
<dd><p>The initial flow control value for the stream. By default flow control is disabled.</p>
</dd>
<dt>reply_to (<code>self()</code>)</dt>
<dd><p>The pid of the process that will receive the response messages.</p>
</dd>
</dl>
<h3 id="_socks_opts">socks_opts()</h3>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">socks_opts</font></b>() <font color="#990000">::</font> #{
    <font color="#FF6600">host</font> <font color="#990000">:=</font> <b><font color="#000000">inet:hostname</font></b>() | <b><font color="#000000">inet:ip_address</font></b>(),
    <font color="#FF6600">port</font> <font color="#990000">:=</font> <b><font color="#000000">inet:port_number</font></b>(),

    <font color="#0000FF">auth</font>      <font color="#990000">=&gt;</font> [{<font color="#FF6600">username_password</font>, <b><font color="#000080">binary</font></b>(), <b><font color="#000080">binary</font></b>()} | <font color="#FF6600">none</font>],
    <font color="#0000FF">protocols</font> <font color="#990000">=&gt;</font> <b><font color="#000000">protocols</font></b>(),
    <font color="#0000FF">transport</font> <font color="#990000">=&gt;</font> <font color="#FF6600">tcp</font> | <font color="#FF6600">tls</font>,
    <font color="#0000FF">version</font>   <font color="#990000">=&gt;</font> <font color="#993399">5</font>,

    <font color="#0000FF">tls_opts</font>              <font color="#990000">=&gt;</font> [<b><font color="#000000">ssl:tls_client_option</font></b>()],
    <font color="#0000FF">tls_handshake_timeout</font> <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>()
}</tt></pre>
</div></div>
<p>Configuration for the Socks protocol.</p>
<p>The default value, if any, is given next to the option name:</p>
<dl><dt>host, port</dt>
<dd><p>Destination hostname and port number. Mandatory.</p>
<p>Upon successful completion of the Socks connection, Gun will begin using these as the host and port of the origin server for subsequent requests.</p>
</dd>
<dt>auth ([none])</dt>
<dd><p>Authentication methods Gun advertises to the Socks proxy.</p>
</dd>
<dt>protocols - see below</dt>
<dd><p>Ordered list of preferred protocols. Please refer to the <code>protocols()</code> type documentation for details.</p>
<p>Defaults to <code>[http]</code> when the transport is <code>tcp</code>, and <code>[http2, http]</code> when the transport is <code>tls</code>.</p>
</dd>
<dt>transport (tcp)</dt>
<dd><p>Transport that will be used for tunneled requests.</p>
</dd>
<dt>tls_opts ([])</dt>
<dd><p>Options to use for tunneled TLS connections.</p>
</dd>
<dt>tls_handshake_timeout (infinity)</dt>
<dd><p>Handshake timeout for tunneled TLS connections.</p>
</dd>
<dt>version (5)</dt>
<dd><p>Version of the Socks protocol to use.</p>
</dd>
</dl>
<h3 id="_ws_opts">ws_opts()</h3>
<div class="listingblock"><div class="content"><!-- Generator: GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000000">ws_opts</font></b>() <font color="#990000">::</font> #{
    <font color="#0000FF">closing_timeout</font> <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">compress</font>        <font color="#990000">=&gt;</font> <b><font color="#000000">boolean</font></b>(),
    <font color="#0000FF">flow</font>            <font color="#990000">=&gt;</font> <b><font color="#000000">pos_integer</font></b>(),
    <font color="#0000FF">keepalive</font>       <font color="#990000">=&gt;</font> <b><font color="#000000">timeout</font></b>(),
    <font color="#0000FF">protocols</font>       <font color="#990000">=&gt;</font> [{<b><font color="#000080">binary</font></b>(), <b><font color="#000000">module</font></b>()}],
    <font color="#0000FF">silence_pings</font>   <font color="#990000">=&gt;</font> <b><font color="#000000">boolean</font></b>()
}</tt></pre>
</div></div>
<p>Configuration for the Websocket protocol.</p>
<p>The default value is given next to the option name:</p>
<dl><dt>closing_timeout (15000)</dt>
<dd><p>Time to wait before brutally closing the connection when a graceful shutdown was requested either via a call to <a href="../gun.shutdown">gun:shutdown(3)</a> or by the server.</p>
</dd>
<dt>compress (false)</dt>
<dd><p>Whether to enable permessage-deflate compression. This does not guarantee that compression will be used as it is the server that ultimately decides. Defaults to false.</p>
</dd>
<dt>flow - see below</dt>
<dd><p>The initial flow control value for the Websocket connection. By default flow control is disabled.</p>
</dd>
<dt>keepalive (5000)</dt>
<dd><p>Time between pings in milliseconds.</p>
</dd>
<dt>protocols ([])</dt>
<dd><p>A non-empty list enables Websocket protocol negotiation. The list of protocols will be sent in the sec-websocket-protocol request header. The handler module interface is currently undocumented and must be set to <code>gun_ws_h</code>.</p>
</dd>
<dt>silence_pings (true)</dt>
<dd><p>Whether the ping and pong frames should be sent to the user. In all cases Gun will automatically send a pong frame back when receiving a ping.</p>
</dd>
</dl>
<!-- @todo Document default_protocol and user_opts.-->
<h2 id="_changelog">Changelog</h2>
<ul><li><strong>2.0</strong>: The types <code>protocols()</code> and <code>socks_opts()</code> have been added. Support for the Socks protocol has been added in every places where protocol selection is available. In addition it is now possible to specify separate HTTP options for the CONNECT proxy and the origin server.
</li>
<li><strong>2.0</strong>: The <code>connect_timeout</code> option has been split into three options: <code>domain_lookup_timeout</code>, <code>connect_timeout</code> and when applicable <code>tls_handshake_timeout</code>.
</li>
<li><strong>2.0</strong>: The option <code>retry_fun</code> was added. It can be used to implement different reconnect strategies.
</li>
<li><strong>2.0</strong>: The <code>transport_opts</code> option has been split into two options: <code>tcp_opts</code> and <code>tls_opts</code>.
</li>
<li><strong>2.0</strong>: Function <code>gun:update_flow/3</code> introduced. The <code>flow</code> option was added to request options and HTTP/1.1, HTTP/2 and Websocket options as well.
</li>
<li><strong>2.0</strong>: Introduce the type <code>req_headers()</code> and extend the types accepted for header names for greater interoperability. Header names are automatically lowercased as well.
</li>
<li><strong>2.0</strong>: Function <code>gun:headers/4,5</code> introduced.
</li>
<li><strong>2.0</strong>: The <code>keepalive</code> option is now set to <code>infinity</code> by default for the HTTP/1.1 protocol, disabling it.
</li>
<li><strong>2.0</strong>: Websocket options <code>keepalive</code> and <code>silence_pings</code> introduced.
</li>
<li><strong>1.3</strong>: Add the CONNECT destination&apos;s <code>protocols</code> option and deprecate the previously introduced <code>protocol</code> option.
</li>
<li><strong>1.2</strong>: Introduce the type <code>connect_destination()</code>.
</li>
</ul>
<h2 id="_see_also">See also</h2>
<p><a href="..">gun(7)</a></p>






</div>

<div class="span3 sidecol">


<h3>
	Gun
	2.0
	Function Reference
	
</h3>

<ul>
	
		<li><a href="/docs/en/gun/2.0/guide">User Guide</a></li>
	
	
		<li><a href="/docs/en/gun/2.0/manual">Function Reference</a></li>
	
	
</ul>

<h4 id="docs-nav">Navigation</h4>

<h4>Version select</h4>
<ul>
	
	
	
		<li><a href="/docs/en/gun/2.0/manual">2.0</a></li>
	
		<li><a href="/docs/en/gun/1.3/manual">1.3</a></li>
	
		<li><a href="/docs/en/gun/1.2/manual">1.2</a></li>
	
		<li><a href="/docs/en/gun/1.1/manual">1.1</a></li>
	
		<li><a href="/docs/en/gun/1.0/manual">1.0</a></li>
	
</ul>

<h3 id="_like_my_work__donate">Like my work? Donate!</h3>
<p>Donate to Loïc Hoguin because his work on Cowboy, Ranch, Gun and Erlang.mk is fantastic:</p>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post" style="display:inline">
<input type="hidden" name="cmd" value="_donations">
<input type="hidden" name="business" value="essen@ninenines.eu">
<input type="hidden" name="lc" value="FR">
<input type="hidden" name="item_name" value="Loic Hoguin">
<input type="hidden" name="item_number" value="99s">
<input type="hidden" name="currency_code" value="EUR">
<input type="hidden" name="bn" value="PP-DonationsBF:btn_donate_LG.gif:NonHosted">
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal - The safer, easier way to pay online!">
<img alt="" border="0" src="https://www.paypalobjects.com/fr_FR/i/scr/pixel.gif" width="1" height="1">
</form><p>Recurring payment options are also available via <a href="https://salt.bountysource.com/teams/ninenines">BountySource</a>. These funds are used to cover the recurring expenses like dedicated servers or domain names.</p>



</div>
</div>
</div>
</div>

      <footer>
        <div class="container">
          <div class="row">
            <div class="span6">
              <p id="scroll-top"><a href="#">↑ Scroll to top</a></p>
              <nav>
                <ul>
                  <li><a href="mailto:contact@ninenines.eu" title="Contact us">Contact us</a></li><li><a href="https://github.com/ninenines/ninenines.github.io" title="Github repository">Contribute to this site</a></li>
                </ul>
              </nav>
            </div>
            <div class="span6 credits">
               <p><img src="/img/footer_logo.png"></p>
               <p>Copyright &copy; Loïc Hoguin 2012-2018</p>
            </div>
          </div>
        </div>
      </footer>

    
    <script src="/js/custom.js"></script>
  </body>
</html>


